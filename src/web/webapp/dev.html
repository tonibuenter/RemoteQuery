<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">

<link rel="shortcut icon" href="img/remote-query-icon.png"
	type="image/png">

<link rel="icon" href="img/remote-query-icon.png" type="image/x-icon">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- ----------------- -->
<!-- JQUERY 3 and more -->
<!-- ----------------- -->
<script src="libs/jquery-3.2.1.js" type="text/javascript"></script>
<script src="libs/underscore.js" type="text/javascript"></script>
<script src="libs/moment-with-locales.js" type="text/javascript"></script>



<!-- http://materializecss.com -->

<link rel="stylesheet" href="libs/materialize/css/materialize.css">
<script src="libs/materialize/js/materialize.js"></script>

<!-- -------------- -->
<!-- Material Icons -->
<!-- -------------- -->
<!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" -->
<!-- 	rel="stylesheet"> -->

<link rel="stylesheet" href="libs/material-design-icons/mdi.css">


<!-- ------------------- -->
<!-- AMINMATE CSS -->
<!-- ------------------- -->
<!-- https://github.com/daneden/animate.css -->

<link type="text/css" rel="stylesheet" href="libs/animate.css" />


<!-- ------------ -->
<!-- Remote Query -->
<!-- ------------ -->

<script src="js/remotequery-0.9.0.js" type="text/javascript"></script>
<script src="js/app-ui.js" type="text/javascript"></script>

<!-- --------- -->
<!-- THIS DEMO -->
<!-- --------- -->

<link href="css/demo.css" type="text/css" rel="stylesheet" />
<script src="js/demo.js" type="text/javascript"></script>




</head>

<body>
	<div class="container">
		<div>
			<section>
				<h3>Services</h3>
			</section>
		</div>

		<div class="row">

			<div class="input-field col s6">
				<input id="nameFilter" type="text" class="validate"> <label
					for="nameFilter">Service Filter</label>
			</div>

			<div class="input-field col s6">
				<a id="search" class="waves-effect red waves-light btn"><i
					class="material-icons left">search</i>Search</a>
			</div>
		</div>



		<section>
			<table>
				<thead>
					<tr>
						<th>Service Id</th>
						<th>Roles</th>
						<th>Statements</th>
					</tr>
				</thead>
				<tbody id="tbody">
				</tbody>
			</table>
		</section>

		<div class="demo-message" id="message"></div>
	</div>

	<script>
    $(function() {

      var search$ = $('#search');
      var nameFilter$ = $('#nameFilter');

      search$.click(function() {
        var nameFilter = nameFilter$.val() + '%';
        rQ.call('RQService.search', {
          'nameFilter' : nameFilter
        }, function(data) {
          var list = rQ.asList(data);

          var head$ = $('#thead-tr').empty();
          var body$ = $('#tbody').empty();
          var message$ = $('#message').empty();
          if (list.length == 0) {
            message$.text("No data found!");
          }
          _.each(list, function(e) {
            body$.append($('<tr>').append(
                $('<td>').append(serviceId$(e.serviceId)),
                $('<td>').append(roles$(e.roles)),
                $('<td>').append($('<pre>').text(e.statements))))
          });
        });
      });

      nameFilter$.keypress(function(e) {
        var code = e.keyCode || e.which;
        if (code == 13) {
          search$.click();
        }
      });

      function serviceId$(serviceId) {
        var r = '', ident=0;
        serviceId.split(".").forEach(function(item) {
          if (r) {
            r += '.';
          }
          r += '<div>' + item + '</div>';
          ident++;
        });
        return r;
      }

      function roles$(roles) {
        var r = '';
        roles.split(",").forEach(function(item) {
          r += '<div>' + item + '</div>';
        });
        return r;
      }

    });
  </script>


</body>
</html>







